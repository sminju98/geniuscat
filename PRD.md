# 냥냥분석 PRD (Product Requirements Document)

## 1. 프로젝트 개요

- **프로젝트명:** 냥냥분석 (GeniusCat)
- **설명:** 사용자가 자신의 사진을 업로드하면 AI(GPT-4.0 mini)가 분석해주는 재미 테스트 웹사이트
- **타겟:** 비회원, 모바일 중심, 즉시 사용 가능한 재미 테스트 서비스
- **로그인/회원가입:** 없음

---

## 2. 핵심 기능 요약

- **테스트 페이지:** 각 테스트는 별도의 `.html` 파일로 구성 (`soulmate.html`, `celebrity.html`, ...)
- **공통 JS 스크립트:** `script.js` 단일 파일에서 모든 로직 처리 (사진 업로드, API 호출, 로딩/결과 분기)
- **공통 API:** `/analyze` 하나의 endpoint 사용, `handlers.js`에서 testId 기반으로 프롬프트 분기
- **결과 페이지:** 별도 페이지 없이 JS로 현재 DOM을 동적으로 수정
- **이미지 분석:** 업로드한 사진을 GPT-4.0 mini로 전송하여 분석, 응답 텍스트 기반으로 관련 이미지 검색 (Google Search API 사용)

---

## 3. 파일 구조

```
/public
├── index.html          # 메인 페이지
├── soulmate.html       # 운명의 배우자 테스트
├── celebrity.html      # 닮은 연예인 테스트
├── script.js           # 모든 테스트에 공통으로 사용되는 JS
└── style.css           # 전역 스타일

/server
├── index.js           # 서버 시작점 (Express)
└── handlers.js        # testId에 따른 GPT 프롬프트 분기 및 응답 처리
```

---

## 4. 사용자 플로우

```
[사용자 진입: soulmate.html 등 테스트 페이지]
↓
[사진 업로드 input 클릭 → JS로 파일 읽기]
↓
[로딩 UI 표시 (DOM 수정)]
↓
[script.js → /analyze POST 요청 전송 (testId + base64)]
↓
[GPT 응답 도착 → Google 이미지 검색]
↓
[결과 HTML 동적 생성 → 현재 페이지에 렌더링]
```

---

## 5. 프론트엔드 상세 (script.js)

### 핵심 역할
- 사진 업로드 수신
- testId에 따라 API 요청 분기
- 로딩 UI 표시 및 숨기기
- 결과 응답 렌더링

### 전역 변수
- `window.testId`: 각 테스트 페이지 상단에서 선언
  ```html
  <script>window.testId = "soulmate";</script>
  ```

---

## 6. 백엔드 상세 (Express API)

### `/analyze` endpoint

#### 요청 형식:
```json
{
  "testId": "soulmate",
  "imageBase64": "data:image/jpeg;base64,..."
}
```

#### 내부 흐름:
1. handlers.js에서 testId에 따라 프롬프트 분기
2. GPT-4.0 mini 호출
3. 응답에서 키워드 추출
4. 관련 이미지 검색 (Google Search API)
5. 결과 JSON 반환

---

## 7. 기술 스택

| 영역 | 기술 |
|------|------|
| 프론트엔드 | HTML + JS (script.js) |
| 백엔드 | Node.js + Express |
| AI | OpenAI GPT-4.0 mini API |
| 이미지 검색 | Google Custom Search API |
| 호스팅 | Firebase Hosting |

---

## 8. 확장 계획

- [ ] 테스트 종류 추가: .html 파일만 복제 + window.testId 변경
- [ ] 결과 저장 기능 (로컬스토리지 기반)
- [ ] SNS 공유 버튼 (카카오, 인스타, 복사)
- [ ] 다국어 버전 대응 (영문/일문)

---

## 9. 보안 및 제한사항

- 이미지 데이터는 base64로 인코딩하여 전송
- API 키는 환경 변수로 관리
- 이미지 URL 필터링 (접근 제한된 도메인 제외)
- 요청 제한: IP당 분당 10회

---

## 10. 에러 처리 및 사용자 피드백

### 10.1 프론트엔드 에러 처리
- 이미지 업로드 실패 시 사용자 친화적 메시지 표시
- API 요청 실패 시 재시도 버튼 제공
- 네트워크 오류 시 오프라인 모드 안내

### 10.2 백엔드 에러 처리
- GPT API 오류 시 대체 응답 제공
- 이미지 검색 실패 시 기본 이미지 사용
- 요청 제한 초과 시 적절한 에러 메시지 반환

---

## 11. 이미지 처리 제한사항

### 11.1 업로드 제한
- 최대 파일 크기: 5MB
- 지원 형식: JPG, PNG, WEBP
- 최소 해상도: 300x300px
- 최대 해상도: 2048x2048px

### 11.2 이미지 최적화
- 업로드 시 자동 리사이징
- WebP 포맷 우선 사용
- 이미지 압축 적용

---

## 12. 성능 최적화

### 12.1 프론트엔드
- 이미지 지연 로딩 적용
- 스크립트 비동기 로딩
- 캐시 전략 구현
- 불필요한 리렌더링 방지

### 12.2 백엔드
- API 응답 캐싱
- 이미지 검색 결과 캐싱
- 요청 큐잉 시스템
- 배치 처리 구현

---

## 13. 모니터링 및 로깅

### 13.1 모니터링 지표
- API 응답 시간
- 에러 발생률
- 이미지 처리 성공률
- 사용자 세션 지속 시간

### 13.2 로깅
- 에러 로그 상세 기록
- 사용자 행동 분석
- API 호출 통계
- 리소스 사용량 모니터링

---

## 14. 확장 계획

- [ ] 테스트 종류 추가: .html 파일만 복제 + window.testId 변경
- [ ] 결과 저장 기능 (로컬스토리지 기반)
- [ ] SNS 공유 버튼 (카카오, 인스타, 복사)
- [ ] 다국어 버전 대응 (영문/일문) 